<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ ì •ë³´ ë° ì¼ì • ì•ˆë‚´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', 'Malgun Gothic', 'Apple SD Gothic Neo', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #000000;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            transition: background 0.5s ease;
        }

        .screen {
            /* ê¸°ë³¸ ëª¨ë“œ (í™”ë©´ ì „í™˜) ìŠ¤íƒ€ì¼ */
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 1s ease-in-out;
            z-index: 10; padding: 1rem;
        }

        /* [ì¶”ê°€ë¨] ìœ„ì ¯ ëª¨ë“œ í™œì„±í™” ì‹œ ìŠ¤íƒ€ì¼ */
        body.widget-mode {
            display: grid !important;
            grid-template-columns: 1.6fr 1fr; 
            grid-template-rows: 1fr 1fr;
            grid-template-areas: 
                "area1 area2"
                "area1 area3";
            gap: 1.5rem;
            padding: 2rem;
            height: 100vh; /* í™”ë©´ ê½‰ ì±„ì›€ */
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            box-sizing: border-box;
        }
        
        body.widget-mode .screen {
            position: relative !important;
            width: 100% !important;
            height: 100% !important;
            opacity: 1 !important;
            visibility: visible !important;
            top: auto !important; 
            left: auto !important;
            transform: none !important;
            padding: 0 !important;
            margin: 0 !important;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10 !important;
        }
        
        /* ìœ„ì ¯ ëª¨ë“œì¼ ë•Œ ì„¤ì • ì°½ ìœ„ì¹˜ ë³´ì • (ì¤‘ì•™ ìœ ì§€) */
        body.widget-mode #settings-modal {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }

        /* [ìˆ˜ì •ë¨] ë©”ì¸ ì¹´ë“œ: ê°€ë¡œ ê¸¸ì´ë¥¼ ë‚´ìš©ì— ë§ì¶¤ */
        .glass-card {
            width: fit-content; /* ë‚´ìš©ëŸ‰ì— ë§ì¶° ì¤„ì–´ë“¦ */
            min-width: 320px;   /* ìµœì†Œ ë„ˆë¹„ */
            max-width: 90vw;    /* í™”ë©´ ë„˜ì¹¨ ë°©ì§€ */
            margin: 0 auto;     /* ì¤‘ì•™ ì •ë ¬ */
            
            /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
            background: radial-gradient(125% 125% at 50% 20%, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border-radius: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.6);
            border-left: 1px solid rgba(255, 255, 255, 0.6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.4),
                inset 2px 2px 15px rgba(255, 255, 255, 0.25),
                inset -5px -5px 15px rgba(0, 0, 0, 0.15);
            transition: all 0.5s ease-in-out, backdrop-filter 1s ease-out, -webkit-backdrop-filter 1s ease-out;
        }

        /* [ìˆ˜ì •ë¨] ì„¤ì • ë²„íŠ¼ ë“± ì›í˜• ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°•í™” (ë¡œê³  ë°•ìŠ¤ì™€ ë™ì¼ íš¨ê³¼) */
        .edit-btn, #back-settings-btn, #close-settings-btn {
            background: radial-gradient(125% 125% at 50% 20%, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border-top: 1px solid rgba(255, 255, 255, 0.6);
            border-left: 1px solid rgba(255, 255, 255, 0.6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3), inset 1px 1px 5px rgba(255, 255, 255, 0.2);
            
            /* í¬ê¸° ë° ë ˆì´ì•„ì›ƒ */
            width: 48px; height: 48px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            color: white; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ ê°•ì œ ì§€ì • */
        }
        .edit-btn:hover, #back-settings-btn:hover, #close-settings-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), inset 1px 1px 8px rgba(255, 255, 255, 0.3);
            background: radial-gradient(125% 125% at 50% 20%, rgba(255, 255, 255, 0.25) 0%, rgba(255, 255, 255, 0.05) 100%);
        }

        /* 2. ì„¤ì •ì°½ ë‚´ë¶€ ì„¹ì…˜: ë™ì¼í•œ íš¨ê³¼ì§€ë§Œ ì•½ê°„ íˆ¬ëª…í•˜ê²Œ */
        .glass-section { 
            background: radial-gradient(125% 125% at 50% 10%, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.02) 100%);
            backdrop-filter: blur(12px) saturate(150%);
            -webkit-backdrop-filter: blur(12px) saturate(150%);
            border-radius: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.4);
            border-left: 1px solid rgba(255, 255, 255, 0.4);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: inset 1px 1px 10px rgba(255,255,255,0.1);
        }

        /* 3. ì…ë ¥ì°½: ì•ˆìœ¼ë¡œ íŒŒì¸ ëŠë‚Œ ëŒ€ì‹  í†µì¼ê°ì„ ìœ„í•´ ë³¼ë¡í•˜ì§€ë§Œ ì¡°ê¸ˆ ì–´ë‘ìš´ ìœ ë¦¬ ëŠë‚Œ */
        .glass-input { 
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.02));
            border-top: 1px solid rgba(255, 255, 255, 0.4);
            border-left: 1px solid rgba(255, 255, 255, 0.4);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px; 
            padding: 0.75rem 1rem; 
            color: white; 
            transition: all 0.3s ease; 
            box-shadow: inset 2px 2px 8px rgba(0,0,0,0.1);
        }
        .glass-input:focus { 
            outline: none; 
            background: rgba(255,255,255,0.2); 
            box-shadow: 0 0 0 2px rgba(255,255,255,0.3); 
        }

        /* 4. ë²„íŠ¼: í´ë¦­ ê°€ëŠ¥í•œ ë³¼ë¡ ë Œì¦ˆ íš¨ê³¼ */
        .glass-button { 
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05)); 
            backdrop-filter: blur(8px) saturate(140%); 
            -webkit-backdrop-filter: blur(8px) saturate(140%); 
            border-top: 1px solid rgba(255,255,255,0.5); 
            border-left: 1px solid rgba(255,255,255,0.5); 
            border-bottom: 1px solid rgba(255,255,255,0.1); 
            border-right: 1px solid rgba(255,255,255,0.1); 
            color: white; 
            border-radius: 12px; 
            padding: 0.75rem 1.5rem; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2), inset 1px 1px 5px rgba(255,255,255,0.2);
        }
        .glass-button:hover { 
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.1)); 
            transform: translateY(-2px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.3), inset 1px 1px 5px rgba(255,255,255,0.3);
        }

        /* 5. D-Day ë°°ë„ˆ: ì¢Œì¸¡ ìƒë‹¨ ì‘ì€ ë°°ë„ˆì—ë„ ë™ì¼ íš¨ê³¼ ì ìš© */
        #dday-banner {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 45;
            display: none;
            padding: 0.55rem 1.2rem; /* ì…ì²´ê°ì„ ìœ„í•´ íŒ¨ë”© ë¯¸ì„¸ ì¡°ì • */
            border-radius: 50px;   /* Pill(ì•Œì•½) ë””ìì¸ ì ìš© */
            color: #ffffff;
            font-weight: 700;
            
            /* í•™êµ ë¡œê³  ë°•ìŠ¤ì™€ ë™ì¼í•œ stereoscopic glass íš¨ê³¼ ì ìš© */
            background: radial-gradient(125% 125% at 50% 20%, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border-top: 1px solid rgba(255, 255, 255, 0.6);
            border-left: 1px solid rgba(255, 255, 255, 0.6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.4),
                inset 2px 2px 15px rgba(255, 255, 255, 0.25),
                inset -5px -5px 15px rgba(0, 0, 0, 0.15);
                
            display: flex;
            gap: 0.6rem;
            align-items: center;
            min-width: 160px;
            max-width: 380px;
        }
        
        .settings-container { position: fixed; top: 5px; right: 5px; z-index: 50; padding: 10px; opacity: 0; transition: opacity 0.5s ease; }
        .edit-btn { background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 4px 10px rgba(0,0,0,0.2); width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; transition: background 0.3s; }
        .edit-btn:hover { background: rgba(255,255,255,0.2); }
        .edit-svg { color: white; transition: transform 0.3s; }
        .edit-btn:hover .edit-svg { transform: scale(1.1); }

        .font-notosanskr { font-family: 'Noto Sans KR', sans-serif; }
        .font-nanumgothic { font-family: 'Nanum Gothic', sans-serif; }
        .font-system { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .settings-view { transition: opacity 0.3s ease; }

        /* D-Day ë°°ë„ˆ (í™”ë©´ ì¢Œì¸¡ ìƒë‹¨) - ì¹´ë“œ ë””ìì¸ê³¼ ì¼ì¹˜í•˜ë„ë¡ ìŠ¤íƒ€ì¼ë§ */
        #dday-banner {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 45;
            display: none;
            padding: 0.55rem 1.2rem; /* ì…ì²´ê°ì„ ìœ„í•´ íŒ¨ë”© ë¯¸ì„¸ ì¡°ì • */
            border-radius: 50px;   /* Pill(ì•Œì•½) ë””ìì¸ ì ìš© */
            color: #ffffff;
            font-weight: 700;
            
            /* í•™êµ ë¡œê³  ë°•ìŠ¤ì™€ ë™ì¼í•œ stereoscopic glass íš¨ê³¼ ì ìš© */
            background: radial-gradient(125% 125% at 50% 20%, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.03) 100%);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border-top: 1px solid rgba(255, 255, 255, 0.6);
            border-left: 1px solid rgba(255, 255, 255, 0.6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.4),
                inset 2px 2px 15px rgba(255, 255, 255, 0.25),
                inset -5px -5px 15px rgba(0, 0, 0, 0.15);
                
            display: flex;
            gap: 0.6rem;
            align-items: center;
            min-width: 160px;
            max-width: 380px;
        }
        #dday-banner .dday-count { font-size: 1rem; padding: 0.15rem 0.5rem; border-radius: 999px; background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); }
        #dday-banner .dday-title { font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* ë¹¨ê°„ ìƒíƒœ (ì¼ì£¼ì¼ ì´ë‚´) */
        #dday-banner.red {
            background: rgba(255, 40, 40, 0.12);
            border-color: rgba(255, 40, 40, 0.6);
            box-shadow: 0 6px 20px rgba(255,40,40,0.08);
        }
        #dday-banner.red .dday-count { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.1); }

        /* Settings sidebar & galaxy style additions */
    .settings-layout { display: flex; gap: 1rem; align-items: stretch; }
        .settings-sidebar { min-width: 14rem; max-height: 70vh; overflow: auto; }
        .settings-details { min-height: 320px; }

        .sidebar-item { transition: all 0.22s ease; border: 1px solid transparent; }
        .sidebar-item:hover { transform: translateX(6px); background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.06); }
        .sidebar-item:focus { outline: none; box-shadow: 0 0 0 3px rgba(99,102,241,0.12); }
        .sidebar-item[aria-pressed="true"], .sidebar-item.active { background: linear-gradient(90deg, rgba(99,102,241,0.07), rgba(255,255,255,0.03)); box-shadow: 0 8px 30px rgba(80,60,200,0.06); border-color: rgba(255,255,255,0.14); }

        /* detail panel glass enhancement */
        .settings-details .glass-section { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius: 14px; }

    /* background preview helpers */
        #bg-preview { background-size: cover; background-position: center; border-radius: 10px; }
    /* removed bg-logo-preview (logo is edited in profile view) */

    /* sidebar profile */
    .sidebar-profile { border-bottom: 1px solid rgba(255,255,255,0.03); margin-bottom: 0.6rem; }
    .sidebar-profile img { box-shadow: 0 6px 18px rgba(0,0,0,0.35); }
    #sidebar-school-name { cursor: pointer; }
    #sidebar-school-name:hover { text-decoration: underline; }

    /* Info view tabs */
    .info-tabs { display: flex; gap: 0.5rem; }
    .info-tab-button { padding: 0.5rem 0.75rem; border-radius: 8px; background: rgba(255,255,255,0.04); color: #fff; border: 1px solid rgba(255,255,255,0.06); cursor: pointer; }
    .info-tab-button.active { background: linear-gradient(90deg, rgba(99,102,241,0.09), rgba(255,255,255,0.02)); box-shadow: 0 6px 18px rgba(80,60,200,0.06); }
    .info-tab-content { color: #eaeef8; }

        /* auxiliary clock (for schedule and custom message screens) */
    .aux-clock { display: none; text-align: center; margin-bottom: 1rem; }
    /* Make auxiliary clocks visually match the main weather clock (responsive) */
    .aux-clock .aux-time { font-weight: 800; line-height: 1; font-size: 3.75rem; /* text-6xl */ }
    @media (min-width: 640px) { .aux-clock .aux-time { font-size: 6rem; /* text-8xl */ } }
    .aux-clock .aux-date { font-size: 1.5rem; /* text-2xl */ opacity: 0.95; margin-top: 0.25rem; }

        /* Auto darken: when body has .bg-darken, darken card backgrounds but KEEP TEXT WHITE.
           We add an overlay (::before) on glass elements and strong text-shadow on key text
           so legibility is improved on very bright backgrounds without making text dark. */
        .bg-darken .glass-card,
        .bg-darken .glass-section {
            background: rgba(0,0,0,0.48) !important; /* darker card */
            border-color: rgba(255,255,255,0.06) !important;
            position: relative; /* for overlay */
            overflow: visible;
        }
        /* subtle darker overlay behind card content for stronger contrast */
        .bg-darken .glass-card::before,
        .bg-darken .glass-section::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: rgba(0,0,0,0.36);
            z-index: 0;
            pointer-events: none;
        }
        /* ensure card contents render above overlay */
        .bg-darken .glass-card > *,
        .bg-darken .glass-section > * {
            position: relative;
            z-index: 1;
        }
        /* preserve white text color, but add heavy shadows for readability */
        .bg-darken #current-time,
        .bg-darken .aux-time,
        .bg-darken h1,
        .bg-darken h2,
        .bg-darken h3,
        .bg-darken .text-white,
        .bg-darken .dday-title,
        .bg-darken .dday-count,
        .bg-darken .glass-card .text-lg,
        .bg-darken .glass-card .text-xl {
            color: #ffffff !important;
            text-shadow: 0 10px 30px rgba(0,0,0,0.6), 0 3px 8px rgba(0,0,0,0.45) !important;
        }
        .bg-darken .glass-card.no-initial-blur { backdrop-filter: blur(6px) !important; }

        /* responsive: stack on small screens */
        @media (max-width: 720px) {
            .settings-layout { flex-direction: column; }
            .settings-sidebar { width: 100%; display: flex; gap: 0.5rem; overflow-x: auto; }
            .sidebar-item { min-width: 12rem; flex-shrink: 0; }
        }

        /* 6. ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€: ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ + í•„(Pill) ë””ìì¸ */
        ::-webkit-scrollbar {
            width: 14px;
        }
        ::-webkit-scrollbar-track {
            background-color: rgba(255, 255, 255, 0.02);
            border-radius: 999px; /* íŠ¸ë™ë„ ë‘¥ê¸€ê²Œ */
            margin: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.15);
            border-radius: 999px; /* ì•Œì•½ ëª¨ì–‘ */
            border: 3px solid transparent; /* íŠ¸ë™ê³¼ì˜ ê°„ê²©ì„ ìœ„í•´ íˆ¬ëª… í…Œë‘ë¦¬ ì‚¬ìš© */
            background-clip: content-box; /* í…Œë‘ë¦¬ ì•ˆìª½ë§Œ ìƒ‰ì¹  */
            backdrop-filter: blur(4px);
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* --- [ìƒˆë¡œ ì¶”ê°€ë¨] ìœ„ì ¯ ëª¨ë“œ ë° ê¸€ë˜ìŠ¤ UI ìŠ¤íƒ€ì¼ --- */

        /* [ìˆ˜ì •ë¨] ì²´í¬ë°•ìŠ¤: ì™„ì „í•œ í°ìƒ‰ ë² ì´ìŠ¤ ë””ìì¸ */
        .glass-checkbox-input:checked + .glass-checkbox-box {
            background: #ffffff; /* ìˆœë°±ìƒ‰ */
            border-color: #ffffff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
        }
        /* ì²´í¬ í‘œì‹œ ìƒ‰ìƒì„ ê²€ì •ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ê°€ì‹œì„± í™•ë³´ */
        .glass-checkbox-input:checked + .glass-checkbox-box::after {
            border-color: #000000; 
        }

        /* ìœ„ì ¯ ëª¨ë“œ ë ˆì´ì•„ì›ƒ ê³ ì • (ìŠ¤í¬ë¡¤ ì œê±°) */
        body.widget-mode {
            display: grid !important;
            grid-template-columns: 1.6fr 1fr; 
            grid-template-rows: 1fr 1fr;
            grid-template-areas: 
                "area1 area2"
                "area1 area3";
            gap: 1.5rem;
            padding: 2rem;
            height: 100vh; /* í™”ë©´ ê½‰ ì±„ì›€ */
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            box-sizing: border-box;
        }

        /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë ˆì´ì•„ì›ƒ ì—ë””í„° ìŠ¤íƒ€ì¼ */
        .layout-editor {
            display: grid;
            grid-template-columns: 1.6fr 1fr;
            grid-template-rows: 1fr 1fr;
            grid-template-areas: 
                "preview1 preview2"
                "preview1 preview3";
            gap: 10px;
            aspect-ratio: 16/9;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        .layout-slot {
            background: rgba(255,255,255,0.05);
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s;
        }
        .layout-slot.hovered {
            background: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.8);
        }
        .layout-slot[data-slot="area1"] { grid-area: preview1; }
        .layout-slot[data-slot="area2"] { grid-area: preview2; }
        .layout-slot[data-slot="area3"] { grid-area: preview3; }

        .layout-card {
            width: 90%;
            height: 90%;
            background: radial-gradient(125% 125% at 50% 20%, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: grab;
            user-select: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
        }
        .layout-card:active { cursor: grabbing; transform: scale(0.98); }
        .layout-card .icon { font-size: 1.5rem; margin-bottom: 0.25rem; }
    </style>
</head>
<body class="min-h-screen text-white overflow-hidden">

    <div class="settings-container">
        <button id="settings-btn" class="edit-btn">
            <svg class="edit-svg w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5L2 22l1.5-5.5L17 3z"/>
            </svg>
        </button>
    </div>

    <div id="settings-modal" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-[60] p-6 glass-card" style="max-width:78rem;width:95%;max-height:92vh;overflow:auto;">
        <div id="settings-header" class="flex justify-between items-center mb-4">
            <button id="back-settings-btn" class="text-2xl text-white hover:text-sky-300 transition-colors hidden font-bold pr-4">&leftarrow;</button>
            <h2 id="settings-title" class="text-2xl font-bold text-white flex-grow text-center sm:text-left">ëŒ€ì‹œë³´ë“œ ì„¤ì •</h2>
            <button id="close-settings-btn" class="text-2xl text-white hover:text-sky-300 transition-colors">&times;</button>
        </div>

        <!-- Galaxy-style two column layout: left sidebar + right detail panel -->
        <div id="settings-content-wrapper" class="overflow-hidden">
            <div class="settings-layout flex gap-4">
                <!-- Sidebar -->
                <aside class="settings-sidebar w-56 p-3 space-y-3 glass-section" aria-label="ì„¤ì • ì‚¬ì´ë“œë°”">
                    <div id="sidebar-profile" class="sidebar-profile flex items-center gap-3 p-2" data-view="profile" tabindex="0" role="button" aria-pressed="false">
                        <img id="sidebar-logo" src="image_5c43d9.png" alt="í•™êµ ë¡œê³ " class="w-14 h-14 rounded-full object-cover border border-white/10">
                        <div>
                            <div id="sidebar-school-name" class="font-semibold">ëŒ€ë¥œê³ ë“±í•™êµ</div>
                            <div class="text-xs text-gray-400">í•™êµ ê³„ì •</div>
                        </div>
                    </div>

                    <div class="sidebar-item p-3 rounded-lg cursor-pointer flex items-center gap-3" data-view="main-menu" tabindex="0" role="button" aria-pressed="true">
                        <span class="w-10 h-10 rounded-md bg-white/6 flex items-center justify-center text-xl">âš™ï¸</span>
                        <div class="text-sm">
                            <div class="font-semibold">ê¸°ë³¸ ì„¤ì •</div>
                            <div class="text-xs text-gray-300">í™”ë©´ ì „í™˜ / ì‹œê°„</div>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg cursor-pointer flex items-center gap-3" data-view="custom-text" tabindex="0" role="button" aria-pressed="false">
                        <span class="w-10 h-10 rounded-md bg-white/6 flex items-center justify-center text-xl">âœï¸</span>
                        <div class="text-sm">
                            <div class="font-semibold">ë©”ì‹œì§€ ì„¤ì •</div>
                            <div class="text-xs text-gray-300">ì»¤ìŠ¤í…€ í…ìŠ¤íŠ¸ ë° ìŠ¤íƒ€ì¼</div>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg cursor-pointer flex items-center gap-3" data-view="schedule-edit" tabindex="0" role="button" aria-pressed="false">
                        <span class="w-10 h-10 rounded-md bg-white/6 flex items-center justify-center text-xl">ğŸ“…</span>
                        <div class="text-sm">
                            <div class="font-semibold">ì¼ì • ê´€ë¦¬</div>
                            <div class="text-xs text-gray-300">í•™ì‚¬ ì¼ì • / D-Day</div>
                        </div>
                    </div>
                    <div class="sidebar-item p-3 rounded-lg cursor-pointer flex items-center gap-3" data-view="background" tabindex="0" role="button" aria-pressed="false">
                        <span class="w-10 h-10 rounded-md bg-white/6 flex items-center justify-center text-xl">ğŸ–¼ï¸</span>
                        <div class="text-sm">
                            <div class="font-semibold">ë°°ê²½ / ë¡œê³ </div>
                            <div class="text-xs text-gray-300">ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
                        </div>
                    </div>
                        <div class="sidebar-item p-3 rounded-lg cursor-pointer flex items-center gap-3" data-view="info" tabindex="0" role="button" aria-pressed="false">
                            <span class="w-10 h-10 rounded-md bg-white/6 flex items-center justify-center text-xl">â„¹ï¸</span>
                            <div class="text-sm">
                                <div class="font-semibold">ì •ë³´</div>
                                <div class="text-xs text-gray-300">ì•± ì •ë³´ ë° ë²„ì „</div>
                            </div>
                        </div>
                    
                </aside>

                <!-- Right detail panel -->
                <section class="settings-details flex-1 p-3">
                    <div class="glass-section p-4 h-full overflow-hidden" style="min-height:320px;">
                        <!-- Existing views are moved into the right panel -->
                        <div id="main-menu-view" class="settings-view space-y-4">
                            <div class="p-4 space-y-5">
                                <h3 class="text-lg font-semibold border-b border-white/30 pb-2 flex items-center gap-2">
                                    <span class="text-xl">ğŸ“º</span> í™”ë©´ í‘œì‹œ ëª¨ë“œ ì„¤ì •
                                </h3>
                                
                                <div class="flex p-1 bg-black/20 rounded-xl border border-white/10 backdrop-blur-md">
                                    <button id="mode-transition" class="flex-1 py-3 rounded-lg text-sm transition-all duration-300 font-bold shadow-sm bg-white/20 text-white" onclick="setDisplayMode('transition')">
                                        ğŸ–¥ï¸ í™”ë©´ ì „í™˜ (ìŠ¬ë¼ì´ë“œ)
                                    </button>
                                    <button id="mode-widget" class="flex-1 py-3 rounded-lg text-sm transition-all duration-300 text-gray-400 hover:text-white hover:bg-white/5" onclick="setDisplayMode('widget')">
                                        ğŸ“‘ ìœ„ì ¯ ëª¨ë“œ (í•œëˆˆì—)
                                    </button>
                                </div>
                                <p class="text-xs text-gray-400 text-center mt-1">
                                    <span id="mode-desc-transition">ì¼ì • ì‹œê°„ë§ˆë‹¤ í™”ë©´ì´ ìë™ìœ¼ë¡œ ì „í™˜ë©ë‹ˆë‹¤.</span>
                                    <span id="mode-desc-widget" class="hidden">ëª¨ë“  ì •ë³´ë¥¼ í•œ í™”ë©´ì—ì„œ ë™ì‹œì— í™•ì¸í•©ë‹ˆë‹¤.</span>
                                </p>

                                <div id="transition-settings-container" class="space-y-4 transition-all duration-300">
                                    <h4 class="text-sm text-gray-400 font-bold uppercase tracking-wider mt-2">ì „í™˜ íƒ€ì´ë° ì„¤ì •</h4>
                                    
                                    <div class="space-y-2">
                                        <label for="weather-duration-slider" class="flex justify-between text-sm text-gray-200">
                                            <span>ë‚ ì”¨/ì‹œê³„ í™”ë©´</span>
                                            <span><span id="weather-duration-value" class="font-bold text-white">8</span>ì´ˆ</span>
                                        </label>
                                        <input type="range" id="weather-duration-slider" min="5" max="60" value="8" class="glass-input w-full">
                                    </div>

                                    <div class="space-y-2">
                                        <label for="schedule-duration-slider" class="flex justify-between text-sm text-gray-200">
                                            <span>í•™ì‚¬ ì¼ì • í™”ë©´</span>
                                            <span><span id="schedule-duration-value" class="font-bold text-white">6</span>ì´ˆ</span>
                                        </label>
                                        <input type="range" id="schedule-duration-slider" min="5" max="60" value="6" class="glass-input w-full">
                                    </div>

                                    <div class="space-y-2">
                                        <label for="custom-duration-slider" class="flex justify-between text-sm text-gray-200">
                                            <span>ì»¤ìŠ¤í…€ ë©”ì‹œì§€ í™”ë©´</span>
                                            <span><span id="custom-duration-value" class="font-bold text-white">8</span>ì´ˆ</span>
                                        </label>
                                        <input type="range" id="custom-duration-slider" min="2" max="30" value="8" class="glass-input w-full">
                                    </div>
                                    
                                    <div class="pt-2 border-t border-white/10">
                                        <label class="glass-checkbox-label flex items-center gap-2 cursor-pointer mb-2">
                                            <input type="checkbox" id="always-show-clock" class="glass-checkbox-input" /> 
                                            <span class="glass-checkbox-box"></span>
                                            <span class="text-sm text-gray-200">ëª¨ë“  í™”ë©´ì— ì‹œê³„ í‘œì‹œ</span>
                                        </label>
                                        
                                        <label class="glass-checkbox-label flex items-center gap-2 cursor-pointer">
                                            <input type="checkbox" id="auto-darken-bg" class="glass-checkbox-input" /> 
                                            <span class="glass-checkbox-box"></span>
                                            <span class="text-sm text-gray-200">ë°ì€ ë°°ê²½ ìë™ ê°ì§€ (ì–´ë‘¡ê²Œ ì²˜ë¦¬)</span>
                                        </label>
                                    </div>
                                </div>

                                <div id="widget-settings-container" class="hidden space-y-4 transition-all duration-300">
                                    <h4 class="text-sm text-gray-400 font-bold uppercase tracking-wider mt-2">í™”ë©´ ë°°ì¹˜ ì„¤ì •</h4>
                                    <p class="text-xs text-gray-400 mb-2">ë°•ìŠ¤ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì›í•˜ëŠ” ìœ„ì¹˜ì— ë†“ìœ¼ì„¸ìš”.</p>

                                    <div class="layout-editor">
                                        <div class="layout-slot" data-slot="area1"></div>
                                        <div class="layout-slot" data-slot="area2"></div>
                                        <div class="layout-slot" data-slot="area3"></div>
                                    </div>

                                    <div class="flex justify-end">
                                        <button class="glass-button text-sm py-2 px-4" onclick="resetWidgetLayout()">ì´ˆê¸°í™”</button>
                                    </div>
                                    
                                    <div class="border-t border-white/10 pt-3 mt-2">
                                        <p class="text-xs text-gray-400 mb-2">í‘œì‹œ ì—¬ë¶€:</p>
                                        <div class="flex gap-4">
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" id="check-weather" class="glass-checkbox-input" checked onchange="toggleWidgetVisibility('weather-screen', this.checked)">
                                                <span class="glass-checkbox-box"></span> <span class="text-sm">ë‚ ì”¨</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" id="check-schedule" class="glass-checkbox-input" checked onchange="toggleWidgetVisibility('schedule-screen', this.checked)">
                                                <span class="glass-checkbox-box"></span> <span class="text-sm">ì¼ì •</span>
                                            </label>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <input type="checkbox" id="check-message" class="glass-checkbox-input" checked onchange="toggleWidgetVisibility('custom-text-screen', this.checked)">
                                                <span class="glass-checkbox-box"></span> <span class="text-sm">ë©”ì‹œì§€</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="p-4 space-y-3">
                                <h3 class="text-lg font-semibold border-b border-white/30 pb-2">ì½˜í…ì¸  í¸ì§‘ ë° UI ìŠ¤íƒ€ì¼</h3>
                                <button id="open-custom-text-btn" class="glass-button w-full flex justify-between items-center">
                                    <span>ì»¤ìŠ¤í…€ ë©”ì‹œì§€ ì„¤ì • ë° ìŠ¤íƒ€ì¼</span>
                                    <span class="text-xl">&gt;</span>
                                </button>
                                <button id="open-schedule-edit-btn" class="glass-button w-full flex justify-between items-center">
                                    <span>í•™ì‚¬ ì¼ì • ê´€ë¦¬</span>
                                    <span class="text-xl">&gt;</span>
                                </button>
                            </div>

                            <div class="p-4 space-y-3">
                                <h3 class="text-lg font-semibold border-b border-white/30 pb-2 flex items-center">
                                    <div class="flex items-center justify-center w-9 h-9 rounded-xl bg-white/10 border border-white/20 backdrop-blur-sm shadow-lg mr-3 text-lg">
                                        ğŸ–¼ï¸
                                    </div>
                                    ë°°ê²½ ë³€ê²½
                                </h3>
                                <label for="bg-upload-modal" class="glass-button w-full text-center cursor-pointer">ë°°ê²½í™”ë©´ ë³€ê²½</label>
                                <input type="file" id="bg-upload-modal" class="hidden" accept="image/*">
                            </div>
                        </div>

                        <div id="custom-text-view" class="settings-view hidden space-y-4">
                            <h4 class="text-xl font-semibold border-b border-white/30 pb-2">ë©”ì‹œì§€ ë‚´ìš© ë° ìŠ¤íƒ€ì¼</h4>
                            <label for="custom-title-input" class="block text-sm font-medium text-gray-200">í™”ë©´ ì œëª© (í™”ë©´ 3)</label>
                            <input type="text" id="custom-title-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì˜¤ëŠ˜ì˜ ë©”ì‹œì§€)" class="glass-input w-full" maxlength="50">
                            <label for="custom-text-input" class="block text-sm font-medium text-gray-200">ë©”ì‹œì§€ ë‚´ìš© (í™”ë©´ 3)</label>
                            <textarea id="custom-text-input" placeholder="ì„¸ ë²ˆì§¸ í™”ë©´ì— í‘œì‹œí•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”." class="glass-input w-full h-20" maxlength="300"></textarea>

                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div>
                                    <label for="text-size-select" class="block text-sm font-medium text-gray-200">ê¸€ì í¬ê¸°</label>
                                    <select id="text-size-select" class="glass-input w-full appearance-none">
                                        <option value="text-2xl">ì‘ê²Œ (2XL)</option>
                                        <option value="text-3xl">ë³´í†µ (3XL)</option>
                                        <option value="text-4xl" selected>í¬ê²Œ (4XL)</option>
                                        <option value="text-5xl">ë§¤ìš° í¬ê²Œ (5XL)</option>
                                        <option value="text-6xl">ìµœëŒ€ í¬ê²Œ (6XL)</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="font-weight-select" class="block text-sm font-medium text-gray-200">ê¸€ì êµµê¸°</label>
                                    <select id="font-weight-select" class="glass-input w-full appearance-none">
                                        <option value="font-light" selected>ì–‡ê²Œ (Light)</option>
                                        <option value="font-normal">ë³´í†µ (Normal)</option>
                                        <option value="font-semibold">êµµê²Œ (SemiBold)</option>
                                        <option value="font-bold">ë§¤ìš° êµµê²Œ (Bold)</option>
                                        <option value="font-extrabold">ìµœëŒ€ êµµê²Œ (ExtraBold)</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="font-family-select" class="block text-sm font-medium text-gray-200">ê¸€ê¼´ (í°íŠ¸)</label>
                                    <select id="font-family-select" class="glass-input w-full appearance-none">
                                        <option value="font-notosanskr">Noto Sans KR (ì›¹ í°íŠ¸)</option>
                                        <option value="font-nanumgothic">Nanum Gothic (ì›¹ í°íŠ¸)</option>
                                        <option value="font-system" selected>ì‹œìŠ¤í…œ ê¸°ë³¸ (ê°€ì¥ ë¹ ë¦„)</option>
                                    </select>
                                    <p class="text-xs text-gray-400 mt-1">(*Windows í™˜ê²½ì— ìµœì í™”)</p>
                                </div>
                            </div>

                            <button id="save-custom-text-btn" class="glass-button w-full mt-2">ë©”ì‹œì§€ ì €ì¥ ë° ì ìš©</button>
                        </div>

                        <div id="schedule-edit-view" class="settings-view hidden space-y-4">
                            <h4 class="text-xl font-semibold border-b border-white/30 pb-2">í•™ì‚¬ ì¼ì • ê´€ë¦¬ ë° í¸ì§‘</h4>

                            <!-- ì¼ì • ì¶”ê°€ í¼ì— D-Day ì²´í¬ë°•ìŠ¤ ì¶”ê°€ -->
                            <form id="schedule-form-modal" class="flex flex-col sm:flex-row gap-4">
                                <input type="date" id="schedule-date-modal" class="glass-input flex-grow" required>
                                <input type="text" id="schedule-event-modal" placeholder="ì¼ì • ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." class="glass-input flex-grow-[2]" required>
                                <label class="glass-input flex items-center gap-2 justify-center">
                                    <input type="checkbox" id="schedule-dday-modal"> D-Day í‘œì‹œ
                                </label>
                                <button type="submit" class="glass-button">ì¼ì • ì¶”ê°€</button>
                            </form>

                            <div class="p-4 max-h-64 overflow-y-auto schedule-list-container">
                                <div id="schedule-list-modal" class="space-y-3"></div>
                            </div>

                            <button id="save-schedule-edit-btn" class="glass-button w-full mt-2">í¸ì§‘ ì™„ë£Œ ë° ì €ì¥</button>
                        </div>

                        <!-- Profile view: edit school name and logo (saved like other settings) -->
                        <div id="profile-view" class="settings-view hidden space-y-4">
                            <h4 class="text-xl font-semibold border-b border-white/30 pb-2">ê³„ì • ì„¤ì •</h4>
                            <label for="profile-school-name-input" class="block text-sm font-medium text-gray-200">ì´ë¦„</label>
                            <input id="profile-school-name-input" type="text" class="glass-input w-full" maxlength="60" placeholder="í•™êµ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">

                            <label class="block text-sm font-medium text-gray-200">ë¡œê³ </label>
                            <div class="flex items-center gap-4">
                                <div class="w-28 h-28 rounded-full overflow-hidden border border-white/10 flex items-center justify-center bg-white/3">
                                    <img id="profile-logo-preview" src="image_5c43d9.png" alt="ë¡œê³  ë¯¸ë¦¬ë³´ê¸°" class="object-contain max-h-full max-w-full">
                                </div>
                                <div class="flex-1">
                                    <label for="profile-logo-input" class="glass-button cursor-pointer">ë¡œê³  ì—…ë¡œë“œ</label>
                                    <input type="file" id="profile-logo-input" class="hidden" accept="image/*">
                                    <p class="text-xs text-gray-400 mt-2">ê¶Œì¥: PNG(íˆ¬ëª…) ë˜ëŠ” JPG ìµœëŒ€ ìš©ëŸ‰: 1MB</p>
                                </div>
                            </div>

                            <div class="flex gap-2 mt-3">
                                <button id="save-profile-btn" class="glass-button">ì €ì¥</button>
                                <button id="cancel-profile-btn" class="glass-button bg-white/6" type="button">ì·¨ì†Œ</button>
                            </div>
                        </div>

                        <!-- Background view: reuses file inputs above but provides quick preview -->
                        <div id="background-view" class="settings-view hidden space-y-4">
                            <h4 class="text-xl font-semibold border-b border-white/30 pb-2">ë°°ê²½ ë° ë¡œê³  ë¯¸ë¦¬ë³´ê¸°</h4>
                            <div class="flex flex-col sm:flex-row gap-4 items-start">
                                <div class="w-full sm:w-1/2">
                                    <label class="block text-sm font-medium text-gray-200 mb-2">í˜„ì¬ ë°°ê²½</label>
                                    <div id="bg-preview" class="w-full h-40 bg-cover bg-center rounded-lg border border-white/10"></div>
                                </div>
                                <!-- removed logo preview column (logo can be edited in í•™êµ ê³„ì • ì„¤ì •) -->
                            </div>
                            <div class="flex gap-2">
                                <label for="bg-upload-modal-2" class="glass-button cursor-pointer">ë°°ê²½ ì—…ë¡œë“œ</label>
                            </div>
                            <input type="file" id="bg-upload-modal-2" class="hidden" accept="image/*">
                            </div>

                            <div id="info-view" class="settings-view hidden space-y-4">
                                <h4 class="text-xl font-semibold border-b border-white/30 pb-2">ì •ë³´</h4>
                                <div class="info-tabs">
                                    <button type="button" class="info-tab-button" data-tab="developer">ê°œë°œì</button>
                                    <button type="button" class="info-tab-button" data-tab="languages">ì‚¬ìš©ëœ ì–¸ì–´</button>
                                    <button type="button" class="info-tab-button" data-tab="version">ë²„ì „</button>
                                </div>

                                <div id="info-developer" class="info-tab-content">
                                    <h5 class="font-semibold">ê°œë°œì ë„êµ¬</h5>
                                    <p class="text-sm text-gray-300">ADK</p>
                                </div>

                                <div id="info-languages" class="info-tab-content hidden">
                                    <h5 class="font-semibold">ì‚¬ìš©ëœ ì–¸ì–´</h5>
                                    <ul class="list-disc pl-5 text-gray-300">
                                        <li>HTML</li>
                                        <li>CSS (Tailwind + custom)</li>
                                        <li>JavaScript</li>
                                    </ul>
                                </div>

                                <div id="info-version" class="info-tab-content hidden">
                                    <h5 class="font-semibold">ë²„ì „</h5>
                                    <p class="text-gray-300">1.0.4</p>
                                </div>
                            </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- D-Day ë°°ë„ˆ (ì¢Œì¸¡ ìƒë‹¨) -->
    <div id="dday-banner" aria-hidden="true">
        <span class="dday-count"></span>
        <span class="dday-title"></span>
    </div>

    <div id="weather-screen" class="screen p-4 sm:p-8">
        <div class="max-w-4xl w-full text-center space-y-8">
            <p id="current-date" class="text-2xl sm:text-3xl font-extrabold mb-4 text-white"></p>
            <h1 id="current-time" class="text-6xl sm:text-8xl font-extrabold tracking-tight text-white">00:00:00</h1>

            <div class="glass-card no-initial-blur p-6 sm:p-8 rounded-[40px] shadow-2xl mt-12">
                <p class="text-xl sm:text-2xl font-semibold text-gray-200 mb-4">í˜„ì¬ ìœ„ì¹˜: ëŒ€êµ¬ ìˆ˜ì„±êµ¬ ë§Œì´Œ 3ë™</p>
                <div class="flex flex-col sm:flex-row justify-around items-center">
                    <div class="flex items-center space-x-4 mb-6 sm:mb-0">
                        <span class="text-6xl sm:text-7xl">â˜€ï¸</span>
                        <div>
                            <p class="text-5xl sm:text-6xl font-bold text-yellow-300">22Â°C</p>
                            <p class="text-lg text-gray-200">ë§‘ìŒ</p>
                        </div>
                    </div>
                    <div class="text-left space-y-2 sm:border-l border-gray-400/50 sm:pl-6">
                        <p class="text-xl font-semibold mb-2 text-gray-200">ì˜¤ëŠ˜ì˜ ì˜ˆë³´</p>
                        <div class="text-lg flex justify-between gap-4"><span>ìµœê³  ê¸°ì˜¨:</span><span class="font-bold text-red-400">25Â°C</span></div>
                        <div class="text-lg flex justify-between gap-4"><span>ìµœì € ê¸°ì˜¨:</span><span class="font-bold text-blue-400">15Â°C</span></div>
                        <p class="text-md text-gray-300 pt-2">í•˜ë£¨ ì¢…ì¼ í™”ì°½í•  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>

            <!-- initial wait removed; slides start immediately based on per-screen durations -->
        </div>
    </div>

    <div id="schedule-screen" class="screen p-4 sm:p-8">
        <div class="max-w-5xl w-full h-full flex flex-col justify-center items-center">
                <div class="aux-clock" id="schedule-aux-clock">
                    <div class="aux-time aux-time-el">00:00:00</div>
                    <div class="aux-date aux-date-el">00ì›” 00ì¼(ìš”ì¼)</div>
                </div>
                <h2 class="text-5xl sm:text-6xl font-extrabold text-white mt-6 mb-6 text-shadow-lg">í•™ì‚¬ ì¼ì • ì•ˆë‚´</h2>
            <div class="glass-card no-initial-blur w-full p-6 sm:p-10 rounded-[40px] shadow-2xl text-left text-white max-h-[70vh] flex flex-col">
                <div class="flex justify-between items-center mb-4 border-b pb-2 border-gray-300/50">
                    <h3 class="text-3xl font-bold text-white">ì£¼ìš” í•™ì‚¬ ì¼ì •</h3>
                </div>
                <div id="schedule-list" class="space-y-4 text-lg overflow-y-auto schedule-list-container pr-2"></div>
            </div>
        </div>
    </div>

    <div id="custom-text-screen" class="screen p-4 sm:p-8">
        <div class="max-w-4xl w-full text-center space-y-8">
            <div class="aux-clock" id="custom-aux-clock">
                <div class="aux-time aux-time-el">00:00</div>
                <div class="aux-date aux-date-el">00ì›” 00ì¼(ìš”ì¼)</div>
            </div>
            <div class="glass-card no-initial-blur p-8 sm:p-12 rounded-[40px] shadow-2xl w-full">
                <h2 id="custom-title" class="text-4xl sm:text-5xl font-extrabold text-white mb-6">í™˜ì˜ ë©”ì‹œì§€</h2>
                <p id="custom-message" class="text-4xl font-light leading-relaxed whitespace-pre-wrap text-white">ì•ˆë…•í•˜ì„¸ìš”! í™˜ì˜í•©ë‹ˆë‹¤.</p>
                <p id="custom-message-placeholder" class="text-xl sm:text-2xl text-gray-400 italic mt-4 hidden">(ì„¤ì •ì—ì„œ ì›í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì—¬ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>
            </div>
        </div>
    </div>

    <div id="school-logo-container" class="glass-card fixed bottom-5 left-1/2 -translate-x-1/2 py-3 px-6 flex items-center gap-4 z-20" style="border-radius: 999px;">
        <img id="school-logo-img" src="image_5c43d9.png" alt="í•™êµ ë¡œê³ " class="h-10 w-auto">
        <span id="school-name-bottom" class="text-white text-lg font-semibold">ëŒ€ë¥œê³ ë“±í•™êµ</span>
    </div>

    <script>
    // per-screen durations in milliseconds (weather, schedule, custom)
    const DEFAULT_DURATIONS = [8000, 6000, 8000];
    let screenDurations = [...DEFAULT_DURATIONS];
    let slideTimeout = null;
        const TRANSITION_DURATION = 1000;
        const DEFAULT_LOGO_URL = 'image_5c43d9.png';

        const SCREENS = ['weather-screen', 'schedule-screen', 'custom-text-screen'];
        let currentScreenIndex = 0;
        let currentSettingsView = 'main-menu';

    const timeElement = document.getElementById('current-time');
    const dateElement = document.getElementById('current-date');
    // auxiliary clocks on other screens
    const auxTimeElems = () => Array.from(document.querySelectorAll('.aux-time'));
    const auxDateElems = () => Array.from(document.querySelectorAll('.aux-date'));
        const weatherScreen = document.getElementById('weather-screen');
        const scheduleScreen = document.getElementById('schedule-screen');
        const customTextScreen = document.getElementById('custom-text-screen');
        const customTitleElement = document.getElementById('custom-title');
        const customMessageElement = document.getElementById('custom-message');
        const customMessagePlaceholder = document.getElementById('custom-message-placeholder');
    // initial wait removed
        const schoolLogoImg = document.getElementById('school-logo-img');
        const scheduleList = document.getElementById('schedule-list');

        const settingsContainer = document.querySelector('.settings-container');
        const settingsModal = document.getElementById('settings-modal');
        const settingsTitle = document.getElementById('settings-title');
        const backSettingsBtn = document.getElementById('back-settings-btn');
        const closeSettingsBtn = document.getElementById('close-settings-btn');
        const settingsContentWrapper = document.getElementById('settings-content-wrapper');

    const mainMenuView = document.getElementById('main-menu-view');
    // per-screen duration controls
    const weatherDurationSlider = document.getElementById('weather-duration-slider');
    const weatherDurationValue = document.getElementById('weather-duration-value');
    const scheduleDurationSlider = document.getElementById('schedule-duration-slider');
    const scheduleDurationValue = document.getElementById('schedule-duration-value');
    const customDurationSlider = document.getElementById('custom-duration-slider');
    const customDurationValue = document.getElementById('custom-duration-value');
        const openCustomTextBtn = document.getElementById('open-custom-text-btn');
        const openScheduleEditBtn = document.getElementById('open-schedule-edit-btn');
    const bgUploadModal = document.getElementById('bg-upload-modal');
    // profile view elements (school name + logo)
    const profileView = document.getElementById('profile-view');
    const profileSchoolNameInput = document.getElementById('profile-school-name-input');
    const profileLogoInput = document.getElementById('profile-logo-input');
    const profileLogoPreview = document.getElementById('profile-logo-preview');
    const saveProfileBtn = document.getElementById('save-profile-btn');
    const cancelProfileBtn = document.getElementById('cancel-profile-btn');

        const customTextView = document.getElementById('custom-text-view');
        const customTitleInput = document.getElementById('custom-title-input');
        const customTextInput = document.getElementById('custom-text-input');
        const textSizeSelect = document.getElementById('text-size-select');
        const fontWeightSelect = document.getElementById('font-weight-select');
        const fontFamilySelect = document.getElementById('font-family-select');
        const saveCustomTextBtn = document.getElementById('save-custom-text-btn');

        const scheduleEditView = document.getElementById('schedule-edit-view');
        const scheduleFormModal = document.getElementById('schedule-form-modal');
        const scheduleDateInputModal = document.getElementById('schedule-date-modal');
        const scheduleEventInputModal = document.getElementById('schedule-event-modal');
        const scheduleDdayModal = document.getElementById('schedule-dday-modal');
        const scheduleListModal = document.getElementById('schedule-list-modal');
        const saveScheduleEditBtn = document.getElementById('save-schedule-edit-btn');

    let schedules = [];
        const currentScreenElements = [weatherScreen, scheduleScreen, customTextScreen];

        const OPENWEATHER_API_KEY = 'af8f2f48035d25a72c21fb5c4a576d5b';
        const weatherCard = weatherScreen.querySelector('.glass-card.no-initial-blur');

        async function fetchManchon3DongWeather() {
            if (!weatherCard) return;
            if (!OPENWEATHER_API_KEY) {
                weatherCard.innerHTML = `<div class="text-sm text-gray-300">OpenWeatherMap API í‚¤ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.</div>`;
                return;
            }
            try {
                const q = encodeURIComponent('ë§Œì´Œ3ë™,ëŒ€êµ¬,KR');
                const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${q}&limit=1&appid=${OPENWEATHER_API_KEY}`);
                const geoJson = await geoRes.json();
                if (!Array.isArray(geoJson) || geoJson.length === 0) {
                    weatherCard.innerHTML = `<div class="text-sm text-gray-300">ìœ„ì¹˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
                    return;
                }
                const { lat, lon, name } = geoJson[0];
                const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=kr&appid=${OPENWEATHER_API_KEY}`);
                const weather = await weatherRes.json();
                if (weather.cod && weather.cod !== 200) {
                    console.error('Weather API error:', weather);
                    weatherCard.innerHTML = `<div class="text-sm text-gray-300">ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>`;
                    return;
                }
                renderWeather(weather, name || 'ë§Œì´Œ3ë™');
            } catch (err) {
                console.error(err);
                weatherCard.innerHTML = `<div class="text-sm text-gray-300">ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>`;
            }
        }

        function renderWeather(data, locationName = '') {
            const temp = Math.round(data.main.temp);
            const feels = Math.round(data.main.feels_like);
            const humidity = data.main.humidity;
            const wind = (data.wind && data.wind.speed) ? data.wind.speed : null;
            const description = data.weather && data.weather[0] ? data.weather[0].description : '';
            const icon = data.weather && data.weather[0] ? data.weather[0].icon : '01d';
            const iconUrl = `https://openweathermap.org/img/wn/${icon}@2x.png`;

            weatherCard.innerHTML = `
                <p class="text-xl sm:text-2xl font-semibold text-gray-200 mb-4">
                    í˜„ì¬ ìœ„ì¹˜: ${locationName}
                </p>
                <div class="flex flex-col sm:flex-row justify-around items-center">
                    <div class="flex items-center space-x-4 mb-6 sm:mb-0">
                        <img src="${iconUrl}" alt="${description}" class="w-20 h-20">
                        <div>
                            <p class="text-5xl sm:text-6xl font-bold text-yellow-300">
                                ${temp}Â°C
                            </p>
                            <p class="text-lg text-gray-200">${description}</p>
                        </div>
                    </div>
                    <div class="text-left space-y-2 sm:border-l border-gray-400/50 sm:pl-6">
                        <p class="text-xl font-semibold mb-2 text-gray-200">ì˜¤ëŠ˜ì˜ ì˜ˆë³´</p>
                        <div class="text-lg flex justify-between gap-4">
                            <span>ì²´ê°ì˜¨ë„:</span>
                            <span class="font-bold text-red-400">${feels}Â°C</span>
                        </div>
                        <div class="text-lg flex justify-between gap-4">
                            <span>ìŠµë„:</span>
                            <span class="font-bold text-blue-400">${humidity}%</span>
                        </div>
                        <p class="text-md text-gray-300 pt-2">${wind !== null ? `í’ì†: ${wind} m/s` : ''}</p>
                    </div>
                </div>
            `;
        }

        function updateTime() {
            const now = new Date();
            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long', timeZone: 'Asia/Seoul' };
            // include seconds for all clocks (HH:MM:SS)
            const timeOptionsWithSeconds = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false, timeZone: 'Asia/Seoul' };
            // full date with weekday (short for aux)
            const dateText = now.toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'short', timeZone: 'Asia/Seoul' });

            // main weather clock and date
            dateElement.textContent = now.toLocaleDateString('ko-KR', dateOptions);
            if (timeElement) timeElement.textContent = now.toLocaleTimeString('ko-KR', timeOptionsWithSeconds);

            // update auxiliary clocks (HH:MM:SS, and e.g. 10ì›” 5ì¼(í™”))
            auxTimeElems().forEach(el => { el.textContent = now.toLocaleTimeString('ko-KR', timeOptionsWithSeconds); });
            auxDateElems().forEach(el => { el.textContent = dateText.replace(/\s+/g, ' '); });
        }

        function toggleCardBlur(screenIndex, enableBlur) {
            const screenElement = currentScreenElements[screenIndex];
            const mainCard = screenElement.querySelector('.glass-card.no-initial-blur');
            if (mainCard) mainCard.classList.toggle('no-initial-blur', !enableBlur);
        }

        function transitionToScreen(nextIndex) {
            const currentElement = currentScreenElements[currentScreenIndex];
            const nextElement = currentScreenElements[nextIndex];
            currentElement.style.opacity = '0';
            currentElement.style.pointerEvents = 'none';
            toggleCardBlur(currentScreenIndex, false);
            setTimeout(() => {
                currentElement.style.zIndex = '5';
                nextElement.style.zIndex = '10';
                nextElement.style.opacity = '1';
                nextElement.style.pointerEvents = 'auto';
                toggleCardBlur(nextIndex, true);
                currentScreenIndex = nextIndex;
            }, TRANSITION_DURATION);
        }

        // cycleScreens removed â€” using startScreenLoop with per-screen durations

        function startScreenLoop() {
            if (slideTimeout) clearTimeout(slideTimeout);
            // schedule next transition after current screen's duration
            const dur = screenDurations[currentScreenIndex] || DEFAULT_DURATIONS[currentScreenIndex];
            slideTimeout = setTimeout(() => {
                const nextIndex = (currentScreenIndex + 1) % SCREENS.length;
                transitionToScreen(nextIndex);
                // after transition completes, start loop again for the new current screen
                setTimeout(startScreenLoop, TRANSITION_DURATION);
            }, dur);
        }

        const SETTINGS_ZONE_RATIO = 0.20;
        function updateSettingsButtonProximity(e) {
            if (!settingsModal.classList.contains('hidden')) { settingsContainer.style.opacity = '0'; return; }
            const x = e.clientX, y = e.clientY, vw = window.innerWidth, vh = window.innerHeight;
            const rightZoneBoundary = vw * (1 - SETTINGS_ZONE_RATIO);
            const topZoneBoundary = vh * SETTINGS_ZONE_RATIO;
            const isInZone = x > rightZoneBoundary && y < topZoneBoundary;
            settingsContainer.style.opacity = isInZone ? '1' : '0';
        }

        // No-op: modal uses fixed height and internal scrolling, so we don't adjust height dynamically.
        function adjustModalHeight() { /* intentionally empty */ }

        function switchSettingsView(viewName) {
            currentSettingsView = viewName;
            const backgroundView = document.getElementById('background-view');
            const profileViewEl = document.getElementById('profile-view');
            const infoViewEl = document.getElementById('info-view');
            [mainMenuView, customTextView, scheduleEditView, backgroundView, profileViewEl, infoViewEl].forEach(view => view && view.classList.add('hidden'));
            let titleText = 'ëŒ€ì‹œë³´ë“œ ì„¤ì •';
            let showBackButton = false;
            let targetView = mainMenuView;

            if (viewName === 'custom-text') {
                titleText = 'ì»¤ìŠ¤í…€ ë©”ì‹œì§€ ì„¤ì •';
                showBackButton = true;
                targetView = customTextView;
            } else if (viewName === 'schedule-edit') {
                titleText = 'í•™ì‚¬ ì¼ì • ê´€ë¦¬';
                showBackButton = true;
                targetView = scheduleEditView;
                renderModalSchedules();
            } else if (viewName === 'background') {
                titleText = 'ë°°ê²½';
                showBackButton = true;
                targetView = backgroundView;
                // populate background preview only (logo edited in profile)
                try {
                    const savedBg = localStorage.getItem('dashboardBackground');
                    const bgPrev = document.getElementById('bg-preview');
                    if (bgPrev) bgPrev.style.backgroundImage = savedBg ? `url(${savedBg})` : '';
                } catch (err) { console.warn('preview load failed', err); }
            } else if (viewName === 'profile') {
                titleText = 'í•™êµ ê³„ì • ì„¤ì •';
                showBackButton = true;
                targetView = profileViewEl;
            } else if (viewName === 'info') {
                titleText = 'ì •ë³´';
                showBackButton = true;
                targetView = infoViewEl;
            }

            settingsTitle.textContent = titleText;
            backSettingsBtn.classList.toggle('hidden', !showBackButton);
            targetView.classList.remove('hidden');

            // update sidebar active state (include profile block which uses data-view)
            document.querySelectorAll('[data-view]').forEach(item => {
                const v = item.dataset.view;
                const active = v === viewName;
                item.classList.toggle('active', active);
                item.setAttribute('aria-pressed', active ? 'true' : 'false');
            });

            setTimeout(() => adjustModalHeight(), 50);
        }

        // Info tab switching inside the ì •ë³´ view
        function switchInfoTab(tabName) {
            document.querySelectorAll('.info-tab-content').forEach(c => c.classList.add('hidden'));
            document.querySelectorAll('.info-tab-button').forEach(b => b.classList.remove('active'));
            const showEl = document.getElementById('info-' + tabName);
            if (showEl) showEl.classList.remove('hidden');
            const btn = document.querySelector(`.info-tab-button[data-tab="${tabName}"]`);
            if (btn) btn.classList.add('active');
        }

        function loadSchedules() {
            const storedSchedules = localStorage.getItem('daeryunSchedules');
            if (storedSchedules) {
                try {
                    schedules = JSON.parse(storedSchedules).map(s => ({ date: s.date, event: s.event, dday: !!s.dday }));
                } catch (e) {
                    schedules = [];
                }
            } else {
                schedules = [
                    { date: '2025-10-28', event: '2í•™ê¸° ì¤‘ê°„ê³ ì‚¬ (~11/1)', dday: false },
                    { date: '2025-11-15', event: 'ìˆ˜ê°• ì² íšŒ ê¸°ê°„ ë§ˆê°ì¼', dday: false },
                    { date: '2025-12-01', event: 'ê³„ì ˆí•™ê¸° ìˆ˜ê°• ì‹ ì²­ ì‹œì‘', dday: false }
                ];
            }
            schedules.sort((a, b) => new Date(a.date) - new Date(b.date));
            renderDisplaySchedules();
        }

        function saveSchedules() {
            schedules.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem('daeryunSchedules', JSON.stringify(schedules));
            updateDdayBanner();
        }

        function calcDdayDiffDays(targetDateStr) {
            const today = new Date();
            const t = new Date(targetDateStr);
            const todayMid = new Date(new Date(today.toLocaleDateString('ko-KR')).getTime());
            const targetMid = new Date(new Date(t.toLocaleDateString('ko-KR')).getTime());
            const diffDays = Math.round((targetMid - todayMid) / (24 * 3600 * 1000));
            return diffDays;
        }

        function updateDdayBanner() {
            const banner = document.getElementById('dday-banner');
            const countEl = banner.querySelector('.dday-count');
            const titleEl = banner.querySelector('.dday-title');

            const ddaySchedules = schedules.filter(s => s.dday);
            if (ddaySchedules.length === 0) {
                banner.style.display = 'none';
                banner.classList.remove('red');
                return;
            }

            // ìš°ì„ ìˆœìœ„: ì•ìœ¼ë¡œ ë‚¨ì€ ë‚ ì§œ(>=0) ì¤‘ ê°€ì¥ ì‘ì€ ê°’ ì„ íƒ. ì—†ìœ¼ë©´ ê³¼ê±° ì¤‘ ê°€ì¥ ìµœê·¼ ì„ íƒ.
            let best = null;
            let bestDiff = Infinity;
            // find future (>=0)
            const future = ddaySchedules.map(s => ({ s, diff: calcDdayDiffDays(s.date) })).filter(x => x.diff >= 0);
            if (future.length > 0) {
                future.sort((a, b) => a.diff - b.diff);
                best = future[0].s;
                bestDiff = future[0].diff;
            } else {
                // choose closest past
                const past = ddaySchedules.map(s => ({ s, diff: calcDdayDiffDays(s.date) })).sort((a, b) => Math.abs(a.diff) - Math.abs(b.diff));
                best = past[0].s;
                bestDiff = past[0].diff;
            }

            const diff = bestDiff;
            let countText = '';
            if (diff > 0) countText = `D-${diff}`;
            else if (diff === 0) countText = `D-Day`;
            else countText = `D+${Math.abs(diff)}`;

            // set color for within 7 days (0..7)
            if (diff >= 0 && diff <= 7) {
                banner.classList.add('red');
            } else {
                banner.classList.remove('red');
            }

            const formattedDate = new Date(best.date).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' });
            countEl.textContent = countText;
            titleEl.textContent = `${best.event} Â· ${formattedDate}`;
            banner.style.display = 'flex';
        }

        function createScheduleElement(date, eventText, targetList, isEditable) {
            const li = document.createElement('li');
            // white text unified, flex layout: D-day | event | date
            li.className = 'flex items-center justify-between bg-white/6 bg-clip-padding p-3 rounded-lg text-white';

            const left = document.createElement('div');
            left.className = 'flex items-center gap-3';

            // D-Day (always shown)
            const diff = calcDdayDiffDays(date);
            const ddaySpan = document.createElement('span');
            ddaySpan.className = 'inline-block font-extrabold py-1 px-3 rounded-full';
            if (diff > 0) ddaySpan.textContent = `D-${diff}`;
            else if (diff === 0) ddaySpan.textContent = 'D-Day';
            else ddaySpan.textContent = `D+${Math.abs(diff)}`;
            // default badge style
            ddaySpan.style.background = 'rgba(255,255,255,0.06)';
            ddaySpan.style.color = '#ffffff';
            ddaySpan.style.border = '1px solid rgba(255,255,255,0.06)';
            // if within 7 days, emphasize in soft red
            if (diff >= 0 && diff <= 7) {
                ddaySpan.style.background = 'rgba(255,40,40,0.12)';
                ddaySpan.style.border = '1px solid rgba(255,40,40,0.6)';
            }

            left.appendChild(ddaySpan);

            // Event title (center)
            const middle = document.createElement('div');
            middle.className = 'flex-1 px-4';
            const eventEl = document.createElement('div');
            eventEl.className = 'text-white';
            eventEl.textContent = eventText;
            middle.appendChild(eventEl);

            // Date (right)
            const right = document.createElement('div');
            right.className = 'text-sm text-white opacity-90';
            const formattedDate = new Date(date).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' });
            right.textContent = formattedDate;

            // If editable, keep the edit controls on the far right as before
            if (isEditable) {
                const controls = document.createElement('div');
                controls.className = 'flex items-center gap-2';

                const ddayLabel = document.createElement('label');
                ddayLabel.className = 'text-sm flex items-center gap-2 text-white';
                const ddayCheckbox = document.createElement('input');
                ddayCheckbox.type = 'checkbox';
                // find corresponding schedule object
                const sched = schedules.find(s => s.date === date && s.event === eventText);
                ddayCheckbox.checked = !!(sched && sched.dday);
                ddayCheckbox.addEventListener('change', () => {
                    if (sched) sched.dday = ddayCheckbox.checked;
                    saveSchedules();
                    renderDisplaySchedules();
                    renderModalSchedules();
                    setTimeout(adjustModalHeight, 100);
                });
                ddayLabel.appendChild(ddayCheckbox);
                ddayLabel.appendChild(document.createTextNode('D-Day'));
                controls.appendChild(ddayLabel);

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'ì‚­ì œ';
                deleteButton.className = 'text-xs bg-red-500/70 hover:bg-red-500/90 text-white py-1 px-3 rounded-md transition-colors';
                deleteButton.onclick = () => { removeSchedule(date, eventText); };
                controls.appendChild(deleteButton);

                li.appendChild(left);
                li.appendChild(middle);
                li.appendChild(right);
                li.appendChild(controls);
            } else {
                // display-only: D-day | event | date
                li.appendChild(left);
                li.appendChild(middle);
                li.appendChild(right);
            }

            targetList.appendChild(li);
        }

        function renderDisplaySchedules() {
            scheduleList.innerHTML = '';
            if (schedules.length === 0) {
                scheduleList.innerHTML = '<p class="text-gray-300">ì¶”ê°€ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                updateDdayBanner();
                return;
            }
            schedules.forEach(schedule => createScheduleElement(schedule.date, schedule.event, scheduleList, false));
            updateDdayBanner();
        }

        function renderModalSchedules() {
            scheduleListModal.innerHTML = '';
            if (schedules.length === 0) {
                scheduleListModal.innerHTML = '<p class="text-gray-300">ì¶”ê°€ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                setTimeout(adjustModalHeight, 50);
                return;
            }
            schedules.forEach(schedule => createScheduleElement(schedule.date, schedule.event, scheduleListModal, true));
            setTimeout(adjustModalHeight, 50);
        }

        function handleAddSchedule(e) {
            e.preventDefault();
            const date = scheduleDateInputModal.value;
            const eventText = scheduleEventInputModal.value;
            const ddayFlag = !!(scheduleDdayModal && scheduleDdayModal.checked);

            if (!date || !eventText) {
                console.warn("ë‚ ì§œì™€ ì¼ì • ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            schedules.push({ date, event: eventText, dday: ddayFlag });
            saveSchedules();
            renderDisplaySchedules();
            renderModalSchedules();

            scheduleDateInputModal.value = '';
            scheduleEventInputModal.value = '';
            if (scheduleDdayModal) scheduleDdayModal.checked = false;
            setTimeout(adjustModalHeight, 100);
        }

        function removeSchedule(date, eventText) {
            schedules = schedules.filter(schedule => !(schedule.date === date && schedule.event === eventText));
            saveSchedules();
            renderDisplaySchedules();
            renderModalSchedules();
            setTimeout(adjustModalHeight, 100);
               }
        function applyStyleClasses(element, prefix, newClass) {
            if (!element) return;
            const classes = Array.from(element.classList);
            const classesToRemove = classes.filter(cls => cls.startsWith(prefix) || (cls.startsWith('sm:') && cls.substring(3).startsWith(prefix)));
            element.classList.remove(...classesToRemove);
            element.classList.add(newClass);
        }

        function loadSettings() {
            const savedBg = localStorage.getItem('dashboardBackground');
            if (savedBg) document.body.style.backgroundImage = `url(${savedBg})`; else document.body.style.backgroundImage = '';
            const savedLogo = localStorage.getItem('dashboardLogo');
            schoolLogoImg.src = savedLogo || DEFAULT_LOGO_URL;
            schoolLogoImg.onerror = () => { schoolLogoImg.src = DEFAULT_LOGO_URL; };

            // load school name
            const savedSchoolName = localStorage.getItem('dashboardSchoolName') || 'ëŒ€ë¥œê³ ë“±í•™êµ';
            const sidebarName = document.getElementById('sidebar-school-name');
            const bottomName = document.getElementById('school-name-bottom');
            if (sidebarName) sidebarName.textContent = savedSchoolName;
            if (bottomName) bottomName.textContent = savedSchoolName;

            // load profile view inputs/previews if present
            if (profileSchoolNameInput) profileSchoolNameInput.value = savedSchoolName;
            const logoUrl = savedLogo || DEFAULT_LOGO_URL;
            if (profileLogoPreview) profileLogoPreview.src = logoUrl;
            if (document.getElementById('sidebar-logo')) document.getElementById('sidebar-logo').src = logoUrl;

            const savedCustomText = localStorage.getItem('dashboardCustomText');
            const savedCustomTitle = localStorage.getItem('dashboardCustomTitle') || 'í™˜ì˜ ë©”ì‹œì§€';
            const savedTextSize = localStorage.getItem('dashboardTextSize') || 'text-4xl';
            const savedFontWeight = localStorage.getItem('dashboardFontWeight') || 'font-light';
            const savedFontFamily = localStorage.getItem('dashboardFontFamily') || 'font-system';

            customTitleElement.textContent = savedCustomTitle;
            customTitleInput.value = savedCustomTitle;
            if (savedCustomText) {
                customMessageElement.textContent = savedCustomText;
                customTextInput.value = savedCustomText;
                customMessagePlaceholder.classList.add('hidden');
            } else {
                customMessageElement.textContent = "ì•ˆë…•í•˜ì„¸ìš”! í™˜ì˜í•©ë‹ˆë‹¤.";
                customTextInput.value = '';
                customMessagePlaceholder.classList.remove('hidden');
            }

            applyStyleClasses(customMessageElement, 'text-', savedTextSize);
            applyStyleClasses(customMessageElement, 'font-', savedFontWeight);
            applyStyleClasses(customMessageElement, 'font-', savedFontFamily);

            textSizeSelect.value = savedTextSize;
            fontWeightSelect.value = savedFontWeight;
            fontFamilySelect.value = savedFontFamily;

            // load per-screen durations (seconds). Fall back to DEFAULT_DURATIONS.
            const savedWeatherSec = parseInt(localStorage.getItem('dashboardDurationWeather'), 10);
            const savedScheduleSec = parseInt(localStorage.getItem('dashboardDurationSchedule'), 10);
            const savedCustomSec = parseInt(localStorage.getItem('dashboardDurationCustom'), 10);
            const wSec = Number.isFinite(savedWeatherSec) ? savedWeatherSec : DEFAULT_DURATIONS[0] / 1000;
            const sSec = Number.isFinite(savedScheduleSec) ? savedScheduleSec : DEFAULT_DURATIONS[1] / 1000;
            const cSec = Number.isFinite(savedCustomSec) ? savedCustomSec : DEFAULT_DURATIONS[2] / 1000;

            // update sliders/labels
            if (weatherDurationSlider) weatherDurationSlider.value = wSec;
            if (weatherDurationValue) weatherDurationValue.textContent = String(wSec);
            if (scheduleDurationSlider) scheduleDurationSlider.value = sSec;
            if (scheduleDurationValue) scheduleDurationValue.textContent = String(sSec);
            if (customDurationSlider) customDurationSlider.value = cSec;
            if (customDurationValue) customDurationValue.textContent = String(cSec);

            // set internal durations in ms
            screenDurations = [wSec * 1000, sSec * 1000, cSec * 1000];

            // load new settings: always show clock & auto darken
            const savedAlwaysClock = localStorage.getItem('dashboardAlwaysShowClock') === '1';
            const savedAutoDarken = localStorage.getItem('dashboardAutoDarken') === '1';
            const alwaysClockEl = document.getElementById('always-show-clock');
            const autoDarkenEl = document.getElementById('auto-darken-bg');
            if (alwaysClockEl) alwaysClockEl.checked = savedAlwaysClock;
            if (autoDarkenEl) autoDarkenEl.checked = savedAutoDarken;

            applyAlwaysShowClock(savedAlwaysClock);
            // check background brightness and apply darken if needed
            applyAutoDarkenSetting(savedAutoDarken);
        }

        function saveCustomText() {
            const title = customTitleInput.value.trim();
            const text = customTextInput.value.trim();
            const sizeClass = textSizeSelect.value;
            const weightClass = fontWeightSelect.value;
            const familyClass = fontFamilySelect.value;

            if (title) localStorage.setItem('dashboardCustomTitle', title); else localStorage.removeItem('dashboardCustomTitle');
            if (text) localStorage.setItem('dashboardCustomText', text); else localStorage.removeItem('dashboardCustomText');

            localStorage.setItem('dashboardTextSize', sizeClass);
            localStorage.setItem('dashboardFontWeight', weightClass);
            localStorage.setItem('dashboardFontFamily', familyClass);

            loadSettings();
            switchSettingsView('main-menu');
        }

        // show/hide auxiliary clocks in other screens
        function applyAlwaysShowClock(enabled) {
           

            const auxs = Array.from(document.querySelectorAll('.aux-clock'));
            auxs.forEach(a => { a.style.display = enabled ? 'block' : 'none'; });
        }

        // brightness detection: determine if background is bright; if so, add .bg-darken to body when autoEnabled
        function luminanceFromRgb(r, g, b) {
            // r,g,b in 0..255
            const srgb = [r, g, b].map(v => v / 255);
            const lin = srgb.map(c => (c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4)));
            return 0.2126 * lin[0] + 0.7152 * lin[1] + 0.0722 * lin[2];
        }

        function checkBackgroundBrightnessAndApply() {
            const autoEnabled = localStorage.getItem('dashboardAutoDarken') === '1';
            if (!autoEnabled) { document.body.classList.remove('bg-darken'); return; }

            const bg = getComputedStyle(document.body).backgroundImage;
            if (bg && bg !== 'none') {
                // attempt to extract URL
                const m = bg.match(/url\((?:\"|\')?(.*?)(?:\"|\')?\)/);
                if (m && m[1]) {
                    const img = new Image();
                    img.crossOrigin = 'Anonymous';
                    img.onload = () => {
                       
                        try {
                            const canvas = document.createElement('canvas');
                            const w = 40, h = 40;
                            canvas.width = w; canvas.height = h;
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, w, h);
                            const data = ctx.getImageData(0,0,w,h).data;
                            let sum = 0, count=0;
                            for (let i=0;i<data.length;i+=4) {
                                const r = data[i], g = data[i+1], b = data[i+2];
                                const lum = luminanceFromRgb(r,g,b);
                                sum += lum; count++;
                            }
                            const avg = sum / count;
                            // if average luminance > 0.6 consider bright
                            if (avg > 0.6) document.body.classList.add('bg-darken'); else document.body.classList.remove('bg-darken');
                        } catch (err) {
                            console.warn('brightness check failed', err);
                            document.body.classList.remove('bg-darken');
                        }
                    };
                    img.onerror = () => { document.body.classList.remove('bg-darken'); };
                    // use saved dashboardBackground if there is one to avoid CORS issues
                    const saved = localStorage.getItem('dashboardBackground');
                    img.src = saved || m[1];
                    return;
                }
            }
            // fallback: examine background-color
            const bgColor = getComputedStyle(document.body).backgroundColor;
            if (bgColor) {
                const rgb = bgColor.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
                if (rgb) {
                    const lum = luminanceFromRgb(parseInt(rgb[1],10), parseInt(rgb[2],10), parseInt(rgb[3],10));
                    if (lum > 0.6) document.body.classList.add('bg-darken'); else document.body.classList.remove('bg-darken');
                    return;
                }
            }
            document.body.classList.remove('bg-darken');
        }

        function applyAutoDarkenSetting(enabled) {
            if (!enabled) { document.body.classList.remove('bg-darken'); return; }
            checkBackgroundBrightnessAndApply();
        }

        // handlers for per-screen duration sliders
        function handleDurationChange(screenIndex, e) {
            const seconds = parseInt(e.target.value, 10) || 5;
            // update label
            if (screenIndex === 0 && weatherDurationValue) weatherDurationValue.textContent = String(seconds);
            if (screenIndex === 1 && scheduleDurationValue) scheduleDurationValue.textContent = String(seconds);
            if (screenIndex === 2 && customDurationValue) customDurationValue.textContent = String(seconds);

            // persist and update runtime durations
            if (screenIndex === 0) localStorage.setItem('dashboardDurationWeather', String(seconds));
            if (screenIndex === 1) localStorage.setItem('dashboardDurationSchedule', String(seconds));
            if (screenIndex === 2) localStorage.setItem('dashboardDurationCustom', String(seconds));

            screenDurations[screenIndex] = seconds * 1000;
            // restart loop to pick up new durations immediately
            try { startScreenLoop(); } catch (err) { console.warn('failed to restart screen loop', err); }
        }

        function handleBgUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                const imgDataUrl = event.target.result;
                document.body.style.backgroundImage = `url(${imgDataUrl})`;
                try { localStorage.setItem('dashboardBackground', imgDataUrl); } catch (error) { console.error("ë°°ê²½í™”ë©´ ì €ì¥ ì‹¤íŒ¨:", error); }
                // re-check brightness for auto-darken
                try { checkBackgroundBrightnessAndApply(); } catch (err) { console.warn(err); }
            };
            reader.readAsDataURL(file);
        }

        // Profile logo upload handler (preview only; saved when user clicks ì €ì¥)
        let pendingProfileLogoDataUrl = null;
        function handleProfileLogoSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                const imgDataUrl = event.target.result;
                pendingProfileLogoDataUrl = imgDataUrl;
                if (profileLogoPreview) profileLogoPreview.src = imgDataUrl;
            };
            reader.readAsDataURL(file);
        }

        // --- ìœ„ì ¯ ëª¨ë“œ ë° ì„¤ì • ì œì–´ ë¡œì§ (ê°œì„ ë¨) ---

        let currentDisplayMode = 'transition'; 
        // ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë§µí•‘ (Area ID -> Screen Element ID)
        let widgetLayout = {
            'area1': 'weather-screen',      // ì™¼ìª½ í° í™”ë©´
            'area2': 'schedule-screen',     // ì˜¤ë¥¸ìª½ ìœ„
            'area3': 'custom-text-screen'   // ì˜¤ë¥¸ìª½ ì•„ë˜
        };

        // 1. ëª¨ë“œ ì „í™˜ í•¨ìˆ˜
        function setDisplayMode(mode) {
            currentDisplayMode = mode;
            const isWidget = (mode === 'widget');
            
            const btnTrans = document.getElementById('mode-transition');
            const btnWidget = document.getElementById('mode-widget');
            const transSettings = document.getElementById('transition-settings-container');
            const widSettings = document.getElementById('widget-settings-container');

            // ì„¤ëª… í…ìŠ¤íŠ¸ í† ê¸€ìš©
            const descTrans = document.getElementById('mode-desc-transition');
            const descWidget = document.getElementById('mode-desc-widget');

            if (isWidget) {
                document.body.classList.add('widget-mode');
                if (slideTimeout) clearTimeout(slideTimeout); // ìŠ¬ë¼ì´ë“œ ì •ì§€
                
                // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½ (Tailwind)
                btnTrans.className = "flex-1 py-3 rounded-lg text-sm transition-all duration-300 text-gray-400 hover:text-white hover:bg-white/5";
                btnWidget.className = "flex-1 py-3 rounded-lg text-sm transition-all duration-300 font-bold shadow-sm bg-white/20 text-white";

                transSettings.classList.add('hidden');
                widSettings.classList.remove('hidden');

                if(descTrans) descTrans.classList.add('hidden');
                if(descWidget) descWidget.classList.remove('hidden');

                // ìœ„ì ¯ ë ˆì´ì•„ì›ƒ ì ìš©
                applyWidgetLayout();
                
                // ì„¤ì •ì°½ ë‚´ ì—ë””í„° ì´ˆê¸°í™”
                initLayoutEditor(); 

            } else {
                document.body.classList.remove('widget-mode');

                // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³µêµ¬
                btnTrans.className = "flex-1 py-3 rounded-lg text-sm transition-all duration-300 font-bold shadow-sm bg-white/20 text-white";
                btnWidget.className = "flex-1 py-3 rounded-lg text-sm transition-all duration-300 text-gray-400 hover:text-white hover:bg-white/5";

                transSettings.classList.remove('hidden');
                widSettings.classList.add('hidden');

                if(descTrans) descTrans.classList.remove('hidden');
                if(descWidget) descWidget.classList.add('hidden');

                // [ì¤‘ìš” ìˆ˜ì •] ê¸°ë³¸ ëª¨ë“œ ë³µê·€ ì‹œ ìŠ¤íƒ€ì¼ ì™„ë²½ ì´ˆê¸°í™”
                resetScreenStylesForTransition();
                
                // ìŠ¬ë¼ì´ë“œ ë£¨í”„ ì¬ê°œ
                startScreenLoop();
            }
            localStorage.setItem('displayMode', mode);
        }

        // 2. [ë²„ê·¸ ìˆ˜ì •ë¨] ê¸°ë³¸ ëª¨ë“œë¡œ ë³µê·€ ì‹œ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” í•¨ìˆ˜
        function resetScreenStylesForTransition() {
            const screens = ['weather-screen', 'schedule-screen', 'custom-text-screen'];
            
            screens.forEach((id, index) => {
                const el = document.getElementById(id);
                if (!el) return;

                // Grid ê´€ë ¨ ì†ì„± ì œê±°
                el.style.gridArea = '';
                el.style.display = 'flex'; 
                el.style.position = 'absolute'; // screen í´ë˜ìŠ¤ ê¸°ë³¸ê°’ ë³µêµ¬
                el.style.width = '100%';
                el.style.height = '100%';
                
                // í˜„ì¬ ì¸ë±ìŠ¤ì— ë”°ë¼ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸° ëª…í™•íˆ ì„¤ì • (ê²¹ì¹¨ ë°©ì§€)
                if (index === currentScreenIndex) {
                    el.style.opacity = '1';
                    el.style.zIndex = '10';
                    el.style.pointerEvents = 'auto';
                    toggleCardBlur(index, true); // ë¸”ëŸ¬ íš¨ê³¼ ì¼œê¸°
                } else {
                    el.style.opacity = '0';
                    el.style.zIndex = '5';
                    el.style.pointerEvents = 'none';
                    toggleCardBlur(index, false);
                }
            });
            
            // ë³´ì¡° ì‹œê³„ ë‹¤ì‹œ í‘œì‹œ (ì„¤ì •ê°’ ë”°ë¦„)
            const showAux = localStorage.getItem('dashboardAlwaysShowClock') === '1';
            applyAlwaysShowClock(showAux);
        }

        // 3. ìœ„ì ¯ ë ˆì´ì•„ì›ƒ ì ìš© í•¨ìˆ˜
        function applyWidgetLayout() {
            if (currentDisplayMode !== 'widget') return;

            // ê° ì˜ì—­(Area)ì— í• ë‹¹ëœ ìŠ¤í¬ë¦° IDë¥¼ ì°¾ì•„ ë°°ì¹˜
            for (const [area, screenId] of Object.entries(widgetLayout)) {
                const el = document.getElementById(screenId);
                if (el) {
                    el.style.display = 'flex';
                    el.style.gridArea = area; // CSS Grid Area í• ë‹¹
                    el.style.opacity = '1';
                    el.style.zIndex = '10';
                    el.style.position = 'relative'; // absolute í•´ì œ
                    el.style.width = '100%';
                    el.style.height = '100%';
                    el.style.pointerEvents = 'auto';
                }
            }

            // ìœ„ì ¯ ëª¨ë“œì—ì„œëŠ” ë³´ì¡° ì‹œê³„ ê°•ì œ ìˆ¨ê¹€ (ë©”ì¸ ì‹œê³„ë§Œ í‘œì‹œ)
            const auxClocks = document.querySelectorAll('.aux-clock');
            auxClocks.forEach(c => c.style.display = 'none');
        }

        // 4. ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë ˆì´ì•„ì›ƒ ì—ë””í„° ì´ˆê¸°í™”
        function initLayoutEditor() {
            const slots = document.querySelectorAll('.layout-slot');
            const cardNames = {
                'weather-screen': { icon: 'ğŸŒ¤ï¸', name: 'ë‚ ì”¨/ì‹œê³„' },
                'schedule-screen': { icon: 'ğŸ“…', name: 'ì¼ì •' },
                'custom-text-screen': { icon: 'ğŸ’¬', name: 'ë©”ì‹œì§€' }
            };

            // ìŠ¬ë¡¯ ë¹„ìš°ê¸°
            slots.forEach(slot => slot.innerHTML = '');

            // í˜„ì¬ ë§¤í•‘ì— ë”°ë¼ ì¹´ë“œ ìƒì„± ë° ë°°ì¹˜
            for (const [area, screenId] of Object.entries(widgetLayout)) {
                const slot = document.querySelector(`.layout-slot[data-slot="${area}"]`);
                if (slot && cardNames[screenId]) {
                    const card = document.createElement('div');
                    card.className = 'layout-card';
                    card.draggable = true;
                    card.dataset.screenId = screenId;
                    card.innerHTML = `<div class="icon">${cardNames[screenId].icon}</div><div>${cardNames[screenId].name}</div>`;
                    
                    // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì—°ê²°
                    card.addEventListener('dragstart', handleDragStart);
                    slot.appendChild(card);
                }
            }

            // ìŠ¬ë¡¯ ì´ë²¤íŠ¸ ì—°ê²°
            slots.forEach(slot => {
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('dragleave', handleDragLeave);
                slot.addEventListener('drop', handleDrop);
            });

            // ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë™ê¸°í™”
            const ids = ['weather-screen', 'schedule-screen', 'custom-text-screen'];
            const checks = ['check-weather', 'check-schedule', 'check-message'];
            ids.forEach((id, idx) => {
                const el = document.getElementById(id);
                const chk = document.getElementById(checks[idx]);
                if(chk) chk.checked = (el.style.display !== 'none');
            });
        }

        // --- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---
        let draggedCard = null;

        function handleDragStart(e) {
            draggedCard = this;
            e.dataTransfer.effectAllowed = 'move';
            setTimeout(() => this.style.opacity = '0.5', 0);
        }

        function handleDragOver(e) {
            e.preventDefault(); // ë“œë¡­ í—ˆìš©
            this.classList.add('hovered');
        }

        function handleDragLeave(e) {
            this.classList.remove('hovered');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('hovered');

            if (this.children.length > 0) {
                // ì´ë¯¸ ì¹´ë“œê°€ ìˆë‹¤ë©´ êµí™˜(Swap)
                const existingCard = this.children[0];
                const originalParent = draggedCard.parentNode;
                originalParent.appendChild(existingCard);
                this.appendChild(draggedCard);
            } else {
                // ë¹ˆ ìŠ¬ë¡¯ì´ë©´ ì´ë™
                this.appendChild(draggedCard);
            }

            draggedCard.style.opacity = '1';
            draggedCard = null;

            // ë³€ê²½ëœ ë ˆì´ì•„ì›ƒ ì €ì¥ ë° ì ìš©
            saveLayoutFromEditor();
        }

        function saveLayoutFromEditor() {
            const slots = document.querySelectorAll('.layout-slot');
            const newLayout = {};
            
            slots.forEach(slot => {
                const area = slot.dataset.slot;
                const card = slot.querySelector('.layout-card');
                if (card) {
                    newLayout[area] = card.dataset.screenId;
                }
            });

            widgetLayout = newLayout;
            localStorage.setItem('widgetLayout', JSON.stringify(widgetLayout));
            applyWidgetLayout(); // ì¦‰ì‹œ í™”ë©´ì— ë°˜ì˜
        }

        function resetWidgetLayout() {
            widgetLayout = {
                'area1': 'weather-screen',
                'area2': 'schedule-screen',
                'area3': 'custom-text-screen'
            };
            localStorage.setItem('widgetLayout', JSON.stringify(widgetLayout));
            initLayoutEditor();
            applyWidgetLayout();
        }

        function toggleWidgetVisibility(screenId, show) {
            const el = document.getElementById(screenId);
            if (el) {
                el.style.display = show ? 'flex' : 'none';
                // ì„¤ì • ì €ì¥ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
            }
        }

        // ì´ˆê¸°í™” ì‹œ ë¡œë“œ ë¡œì§ (initApp ë‚´ í˜¸ì¶œ)
        function loadSavedWidgetSettings() {
            const savedMode = localStorage.getItem('displayMode') || 'transition';
            const savedLayout = localStorage.getItem('widgetLayout');

            if (savedLayout) {
                widgetLayout = JSON.parse(savedLayout);
            }

            // ì•½ê°„ì˜ ì§€ì—° í›„ ëª¨ë“œ ì ìš© (DOM ë Œë”ë§ í™•ë³´)
            setTimeout(() => {
                setDisplayMode(savedMode);
            }, 100);
        }

        // window.onload í•¨ìˆ˜ ë§¨ ì•„ë˜ì— loadSavedWidgetSettings() ì¶”ê°€ í•„ìš”
        // initApp í•¨ìˆ˜ ë§ˆì§€ë§‰ ì¤„ì— loadSavedWidgetSettings(); ì¶”ê°€

        function initApp() {
            updateTime();
            setInterval(updateTime, 1000);
            loadSettings();
            loadSchedules();
            fetchManchon3DongWeather();

            // 1ì‹œê°„ (ë°€ë¦¬ì´ˆ ë‹¨ìœ„: 60ë¶„ * 60ì´ˆ * 1000)
            const ONE_HOUR = 60 * 60 * 1000;

            // 1. ë‚ ì”¨ ì •ë³´: 1ì‹œê°„ë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨
            setInterval(fetchManchon3DongWeather, ONE_HOUR);

            // 2. í•™ì‚¬ì¼ì • ë° D-Day: 1ì‹œê°„ë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨ (ë‚ ì§œê°€ ë°”ë€Œë©´ D-Day ìˆ«ì ê°±ì‹ )
            setInterval(() => {
                console.log("Auto-refreshing schedule and D-Day...");
                // ì „ì²´ ë¡œì§ì„ ë‹¤ì‹œ ìˆ˜í–‰í•  í•„ìš” ì—†ì´ D-Day ê³„ì‚°ë§Œ ë‹¤ì‹œ ë Œë”ë§
                renderDisplaySchedules(); 
            }, ONE_HOUR);

            document.getElementById('settings-btn').addEventListener('click', () => { settingsModal.classList.remove('hidden'); settingsContainer.style.opacity = '0'; switchSettingsView('main-menu'); });
            closeSettingsBtn.addEventListener('click', () => settingsModal.classList.add('hidden'));
            backSettingsBtn.addEventListener('click', () => switchSettingsView('main-menu'));

            openCustomTextBtn.addEventListener('click', () => switchSettingsView('custom-text'));
            openScheduleEditBtn.addEventListener('click', () => switchSettingsView('schedule-edit'));

            // wire per-screen duration sliders
            if (weatherDurationSlider) weatherDurationSlider.addEventListener('input', (e) => handleDurationChange(0, e));
            if (scheduleDurationSlider) scheduleDurationSlider.addEventListener('input', (e) => handleDurationChange(1, e));
            if (customDurationSlider) customDurationSlider.addEventListener('input', (e) => handleDurationChange(2, e));

            scheduleFormModal.addEventListener('submit', handleAddSchedule);
            saveScheduleEditBtn.addEventListener('click', () => switchSettingsView('main-menu'));

            saveCustomTextBtn.addEventListener('click', saveCustomText);
            if (bgUploadModal) bgUploadModal.addEventListener('change', handleBgUpload);
            // profile logo input
            if (profileLogoInput) profileLogoInput.addEventListener('change', handleProfileLogoSelect);
            // new settings toggles
            const alwaysClockToggle = document.getElementById('always-show-clock');
            const autoDarkenToggle = document.getElementById('auto-darken-bg');
            if (alwaysClockToggle) alwaysClockToggle.addEventListener('change', (e) => {
                const v = !!e.target.checked;
                try { localStorage.setItem('dashboardAlwaysShowClock', v ? '1' : '0'); } catch (err) { console.error(err); }
                applyAlwaysShowClock(v);
            });
            if (autoDarkenToggle) autoDarkenToggle.addEventListener('change', (e) => {
                const v = !!e.target.checked;
                try { localStorage.setItem('dashboardAutoDarken', v ? '1' : '0'); } catch (err) { console.error(err); }
                applyAutoDarkenSetting(v);
            });
            if (saveProfileBtn) saveProfileBtn.addEventListener('click', () => {
                const newName = profileSchoolNameInput ? profileSchoolNameInput.value.trim() : null;
                if (newName && newName.length > 0) {
                    try { localStorage.setItem('dashboardSchoolName', newName); } catch (err) { console.error('save school name failed', err); }
                    const sidebarName = document.getElementById('sidebar-school-name');
                    const bottomName = document.getElementById('school-name-bottom');
                    if (sidebarName) sidebarName.textContent = newName;
                    if (bottomName) bottomName.textContent = newName;
                }
                if (pendingProfileLogoDataUrl) {
                    try { localStorage.setItem('dashboardLogo', pendingProfileLogoDataUrl); } catch (err) { console.error('save logo failed', err); }
                    if (profileLogoPreview) profileLogoPreview.src = pendingProfileLogoDataUrl;
                    if (document.getElementById('sidebar-logo')) document.getElementById('sidebar-logo').src = pendingProfileLogoDataUrl;
                    if (schoolLogoImg) schoolLogoImg.src = pendingProfileLogoDataUrl;
                    pendingProfileLogoDataUrl = null;
                }
                switchSettingsView('main-menu');
            });
            if (cancelProfileBtn) cancelProfileBtn.addEventListener('click', () => {
                // discard pending changes
                pendingProfileLogoDataUrl = null;
                // restore preview to saved logo
                const savedLogo = localStorage.getItem('dashboardLogo') || DEFAULT_LOGO_URL;
                if (profileLogoPreview) profileLogoPreview.src = savedLogo;
                if (profileSchoolNameInput) profileSchoolNameInput.value = localStorage.getItem('dashboardSchoolName') || 'ëŒ€ë¥œê³ ë“±í•™êµ';
                switchSettingsView('main-menu');
            });

            // wire info tab buttons (if present)
            document.querySelectorAll('.info-tab-button').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const t = btn.dataset.tab;
                    if (t) switchInfoTab(t);
                });
            });
            // default info tab
            try { switchInfoTab('developer'); } catch (e) {}

            document.body.addEventListener('mousemove', updateSettingsButtonProximity);

            // Sidebar interactions: click to switch views, keyboard accessible.
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', () => {
                    const view = item.dataset.view;
                    switchSettingsView(view);
                });
                item.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); item.click(); }
                });
            });

            // make the sidebar profile open the profile view when clicked
            const sidebarProfile = document.getElementById('sidebar-profile');
            if (sidebarProfile) {
                sidebarProfile.addEventListener('click', () => switchSettingsView('profile'));
                sidebarProfile.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); sidebarProfile.click(); } });
            }

            // background preview uploads (secondary inputs)
            const bgUpload2 = document.getElementById('bg-upload-modal-2');
            const bgPreview = document.getElementById('bg-preview');
            if (bgUpload2) bgUpload2.addEventListener('change', (e) => {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const imgDataUrl = ev.target.result;
                    document.body.style.backgroundImage = `url(${imgDataUrl})`;
                    if (bgPreview) bgPreview.style.backgroundImage = `url(${imgDataUrl})`;
                    try { localStorage.setItem('dashboardBackground', imgDataUrl); } catch (err) { console.error(err); }
                };
                reader.readAsDataURL(file);
            });

            currentScreenElements.forEach((el, index) => {
                el.style.opacity = index === 0 ? '1' : '0';
                el.style.zIndex = index === 0 ? '10' : '5';
                el.style.pointerEvents = index === 0 ? 'auto' : 'none';
            });

            toggleCardBlur(0, true);
            // start screen loop immediately using per-screen durations
            try { startScreenLoop(); } catch (err) { console.warn('failed to start screen loop', err); }
            // initial brightness check in case background already set
            setTimeout(() => { try { checkBackgroundBrightnessAndApply(); } catch (e) {} }, 200);
        }

        window.onload = initApp;

        function renderWidgetMode() {
            const app = document.getElementById('app');
            app.innerHTML = '';
            app.className = 'w-full h-full p-8 flex gap-8 relative z-10';

            // ì™¼ìª½ íŒ¨ë„ (í•™êµ ì •ë³´ + ë‚ ì”¨ ë“±)
            const leftPanel = document.createElement('div');
            leftPanel.className = 'w-1/3 h-full flex flex-col gap-6';
            
            // í•™êµ ì •ë³´ (ìˆ˜ì •: ë³€ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ë‘ë˜, ì•„ë˜ ì¡°í•© ì‹œ ìœ„ì¹˜ë§Œ ë³€ê²½)
            const schoolInfoHTML = `
                <div class="bg-black/40 backdrop-blur-md rounded-3xl p-6 flex items-center gap-4 border border-white/10">
                    ${schoolLogo ? `<img src="${schoolLogo}" class="w-16 h-16 object-contain">` : ''}
                    <div>
                        <h1 class="text-2xl font-bold text-white">${schoolName || 'í•™êµëª…ì„ ì„¤ì •í•˜ì„¸ìš”'}</h1>
                        <p class="text-white/70">ë°©ì†¡ì‹¤ ëŒ€ê¸°í™”ë©´ ì‹œìŠ¤í…œ</p>
                    </div>
                </div>
            `;

            // ì‹œê³„
            const clockHTML = `
                <div id="widget-clock-container" class="bg-black/40 backdrop-blur-md rounded-3xl p-6 border border-white/10 text-center">
                    <div id="widget-clock" class="text-6xl font-black text-white tracking-tighter font-mono leading-none">00:00:00</div>
                    <div id="widget-date" class="text-white/70 mt-2 text-lg">1ì›” 1ì¼ ì›”ìš”ì¼</div>
                </div>
            `;

            // ìœ„ì ¯ (ê¸‰ì‹/ì‹œê°„í‘œ/í•™ì‚¬ì¼ì • ì¤‘ íƒ1)
            let widgetContent = '';
            const activeWidget = localStorage.getItem('activeWidget') || 'meal';
            
            if (activeWidget === 'meal') {
                widgetContent = `
                    <div class="bg-black/40 backdrop-blur-md rounded-3xl p-6 border border-white/10 flex-1 flex flex-col overflow-hidden">
                        <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <span class="text-yellow-400">ğŸš</span> ì˜¤ëŠ˜ì˜ ê¸‰ì‹
                        </h2>
                        <div class="flex-1 overflow-y-auto custom-scrollbar text-white/90 whitespace-pre-line leading-relaxed text-lg">
                            ${cachedMealData || 'ê¸‰ì‹ ì •ë³´ ë¡œë”©ì¤‘...'}
                        </div>
                    </div>
                `;
            } else if (activeWidget === 'timetable') {
                widgetContent = `
                    <div class="bg-black/40 backdrop-blur-md rounded-3xl p-6 border border-white/10 flex-1 flex flex-col overflow-hidden">
                        <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <span class="text-blue-400">ğŸ“…</span> ì˜¤ëŠ˜ì˜ ì‹œê°„í‘œ
                        </h2>
                        <div class="flex-1 overflow-y-auto custom-scrollbar text-white/90 whitespace-pre-line leading-relaxed text-lg">
                            ${cachedTimetableData || 'ì‹œê°„í‘œ ì •ë³´ ë¡œë”©ì¤‘...'}
                        </div>
                    </div>
                `;
            } else if (activeWidget === 'schedule') {
                widgetContent = `
                    <div class="bg-black/40 backdrop-blur-md rounded-3xl p-6 border border-white/10 flex-1 flex flex-col overflow-hidden">
                        <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <span class="text-green-400">ğŸ“†</span> í•™ì‚¬ì¼ì •
                        </h2>
                        <div class="flex-1 overflow-y-auto custom-scrollbar text-white/90 whitespace-pre-line leading-relaxed text-lg">
                            ${cachedScheduleData || 'í•™ì‚¬ì¼ì • ì •ë³´ ë¡œë”©ì¤‘...'}
                        </div>
                    </div>
                `;
            }

            // [ìˆ˜ì •ë¨] ìˆœì„œ ë³€ê²½: ì‹œê³„(Top) -> ìœ„ì ¯(Middle) -> í•™êµì •ë³´(Bottom)
            // ê¸°ì¡´: schoolInfoHTML + widgetContent + clockHTML
            leftPanel.innerHTML = clockHTML + widgetContent + schoolInfoHTML;
            
            // ì˜¤ë¥¸ìª½ íŒ¨ë„ (ê³µì§€ì‚¬í•­/ì•ˆë‚´ë¬¸êµ¬)
            const rightPanel = document.createElement('div');
            rightPanel.className = 'flex-1 h-full bg-black/40 backdrop-blur-md rounded-3xl p-8 border border-white/10 flex flex-col justify-center items-center text-center relative overflow-hidden';
            
            const message = localStorage.getItem('customMessage') || 'ë°©ì†¡ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤\nì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”';
            rightPanel.innerHTML = `
                <div class="absolute inset-0 bg-gradient-to-br from-blue-500/10 to-purple-500/10 pointer-events-none"></div>
                <div class="relative z-10">
                    <div class="text-5xl md:text-7xl font-black text-white leading-tight drop-shadow-2xl whitespace-pre-line animate-fade-in-up">
                        ${message}
                    </div>
                </div>
            `;

            app.appendChild(leftPanel);
            app.appendChild(rightPanel);

            // ì‹œê³„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ (ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ê¸°ì¡´ ì¸í„°ë²Œ í™•ì¸ ë“±ì€ updateWidgetClock ë‚´ë¶€ì—ì„œ ì²˜ë¦¬ ê¶Œì¥)
            updateWidgetClock();
        }
    </script>
</body>
</html>
